!function(e){"use strict";e.fn.cleanHtml=function(){var t=e(this).html();return t&&t.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},e.fn.wysiwyg=function(t){var n,o,a,i,r,l,c,u,s=this,d={},f=!0,m=function(){var e;for(e in d){var t=d[e];"boolean"==typeof t?t===document.queryCommandState(e)||f&&0===e.indexOf("justify")||document.execCommand(e,0,null):t!==document.queryCommandValue(e)&&document.execCommand(e,0,t)}},p=function(e){return"[object Array]"!=e.toString()&&(e=e.split(" ")),e.push(""),null!=o.eventNamespace&&o.eventNamespace.length>0?e.join("."+o.eventNamespace+" "):e.join(" ")},y=(i=function(){o.activeToolbarClass&&(e(o.toolbarSelector).find(a).each(function(){var t,n=e(this).data(o.commandRole);t=(t=(n=n.split(" ").shift()).indexOf(" "))>=0?n.slice(0,t):n,document.queryCommandState(n)?e(this).addClass(o.activeToolbarClass):t+" "+document.queryCommandValue(t)===n?e(this).addClass(o.activeToolbarClass):e(this).removeClass(o.activeToolbarClass)}),null!==o.setRealFontSize&&void 0!==o.setRealFontSize&&o.setRealFontSize(n))},r=500,function(){var e=l||this,t=(new Date).getTime(),n=arguments;c&&t<c+r?(clearTimeout(u),u=setTimeout(function(){c=t,i.apply(e,n)},r)):(c=t,i.apply(e,n))}),h=function(e,t){var n=e.split(" "),o=n.shift(),a=n.join(" ")+(t||"");0===o.indexOf("justify")&&["left","center","right"].forEach(function(e){d["justify"+e]=!1}),document.execCommand(o,0,a),d[o]=a.length>0?document.queryCommandValue(o):document.queryCommandState(o);-1===["undo","redo"].indexOf(o)&&(m(),y())},g=function(e,t){var n="";e.ctrlKey?n+="ctrl+":e.metaKey&&(n+="meta+"),e.shiftKey&&(n+="shift+");var o=e.keyCode;return o>=20?(96<=e.keyCode&&e.keyCode<=105&&(o-=48),n+=String.fromCharCode(o).toLowerCase()):9===e.keyCode&&(n+="tab"),t[n]},v=function(){return s.attr("contenteditable")&&s.is(":visible")},C=function(){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)},b=function(){!function(){var e;for(e in d){var t=document.queryCommandValue(e),n=document.queryCommandState(e);n?d[e]=n:t&&t.length>0&&"false"!==t?d[e]=t:d[e]=!1}}(),n=C()},w=function(){var e=window.getSelection();if(n){try{e.removeAllRanges()}catch(e){document.body.createTextRange().select(),document.selection.empty()}e.addRange(n)}},R=function(t){s.focus(),e.each(t,function(t,n){/^image\//.test(n.type)?e.when(function(t){var n=e.Deferred(),o=new FileReader;return o.onload=function(e){n.resolve(e.target.result)},o.onerror=n.reject,o.onprogress=n.notify,o.readAsDataURL(t),n.promise()}(n)).done(function(e){h("insertimage",e)}).fail(function(e){o.fileUploadError("file-reader",e)}):o.fileUploadError("unsupported-file-type",n.type)})},k=function(e,t){w(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,t||"transparent"),b(),e.data(o.selectionMarker,t)};return o=e.extend({},e.fn.wysiwyg.defaults,t),a="a[data-"+o.commandRole+"],button[data-"+o.commandRole+"],input[type=button][data-"+o.commandRole+"],div[data-"+o.commandRole+"]",function(e){for(var t in e){var n;if((n=t.split(" ")).length>1){for(var a=0;a<n.length;a++)e[n[a].toLowerCase()]=e[t].toLowerCase();delete e[t]}else e[t.toLowerCase()]=e[t].toLowerCase()}o.eventNamespace;s.on(p("focus"),function(e){setTimeout(function(){m()},0)}),s.on(p("keydown"),e,function(t){var n="";v()&&null!=(n=g(t,e))&&(t.preventDefault(),t.stopPropagation(),"function"==typeof o.hotKeyEnabledCallback&&o.hotKeyEnabledCallback(n)&&h(n))}),s.on(p("keyup"),e,function(t){v()&&null!=g(t,e)&&(t.preventDefault(),t.stopPropagation())})}(o.hotKeys),o.dragAndDropImages&&s.on(p("dragenter dragover"),!1).on(p("drop"),function(e){var t=e.originalEvent.dataTransfer;e.stopPropagation(),e.preventDefault(),t&&t.files&&t.files.length>0&&R(t.files)}),function(t,n){t.find(a).click(function(){w(),s.focus(),m(),h(e(this).data(n.commandRole)),b()}),t.find("[data-toggle=dropdown]").click(w),t.find("input[type=text][data-"+n.commandRole+"]").on(p("webkitspeechchange change"),function(){var t=this.value;this.value="",w(),t&&(s.focus(),h(e(this).data(n.commandRole),t)),b()}).on(p("focus"),function(){var t=e(this);t.data(n.selectionMarker)||(k(t,n.selectionColor),t.focus())}).on(p("blur"),function(){var t=e(this);t.data(n.selectionMarker)&&k(t,!1)}),t.find("input[type=file][data-"+n.commandRole+"]").on(p("change"),function(){w(),"file"===this.type&&this.files&&this.files.length>0&&R(this.files),b(),this.value=""})}(e(o.toolbarSelector),o),s.attr("contenteditable",!0).on(p("mouseup keyup mouseout"),function(){f=!1,setTimeout(function(){b(),y()},0)}).on(p("forceUpdateRange"),function(){b()}),e(a).each(function(){var e=this.getAttribute("data-"+o.commandRole);d[e.split(" ")[0]]=!1}),e(window).bind(p("touchend"),function(e){var t=s.is(e.target)||s.has(e.target).length>0,n=C();n&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&!t||(b(),y())}),this},e.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,eventNamespace:"bootstrap-wysiwyg",hotKeyEnabledCallback:function(e){return!0},fileUploadError:function(e,t){console.log("File upload error",e,t)}}}(window.jQuery);